import { useRef, Fragment, useContext, useEffect, useState } from "react";
import { CSSTransition } from "react-transition-group";
import { useScrollPosition } from "@n8tb1t/use-scroll-position";
import VNav from "../layout/VNav";
import BrowsersHeight from "../utils/BrowsersHeight";
import NotfoundSVG from "../illustration/NotfoundSVG";
import { Link, Redirect } from "react-router-dom";

const NotFound = ({
  toggleNav,
  showNav,
  active,
  currentlyLightTheme,
  toggleActive,
}) => {
  const notfound = useRef();
  const browsersHeight = useContext(BrowsersHeight);
  const [ssr, setSSR] = useState(true);
  const [redirected, setRedirected] = useState(false);
  const [countDown, decrementCount] = useState(7);

  const linkBg = {
    background: currentlyLightTheme && !ssr ? "hsl(169, 38%, 38%)" : "#012a1c",
  };

  useEffect(() => {
    setTimeout(() => {
      decrementCount(countDown - 1);
    }, 1000);
  }, [countDown]);

  useEffect(() => {
    setTimeout(() => {
      setRedirected(true);
    }, 8000);
  }, []);

  useEffect(() => {
    setSSR(false);
  }, []);

  useScrollPosition(
    ({ currPos }) => {
      if (currPos.y <= -browsersHeight / 20) {
        toggleNav(false);
      } else {
        toggleNav(true);
      }
    },
    [],
    notfound
  );

  if (active != "notfound") {
    return null;
  }

  if (redirected) {
    toggleActive("intro");
    return <Redirect to="/" />;
  }

  return (
    <Fragment>
      <VNav
        // handling browser's back button
        active={active}
        showNav={showNav}
        VNavArr={["notfound"]}
      />
      <div ref={notfound} className="separator" id="notfound"></div>
      <div className="page">
        <svg
          className="bg"
          viewBox="0 0 1920 961"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <CSSTransition
            in={true}
            timeout={400}
            classNames="animate-left"
            appear
          >
            <path
              className="svg-bg-path"
              d="M73.5873 139.288V394.274L115.638 410.047V417.933H15.7683V410.047L57.8185 394.274V68.3125L21.0246 57.7976V49.9114H76.2155C94.7876 49.9114 109.33 53.2412 119.843 59.9006C130.355 66.56 140.342 75.4977 149.803 86.7136L318.004 283.868V73.57L275.954 57.7976V49.9114H375.823V57.7976L333.773 73.57V425.819H318.004L73.5873 139.288ZM549.403 425.819C505.952 425.819 471.786 413.552 446.906 389.017C422.377 364.132 410.112 329.958 410.112 286.497C410.112 243.035 422.377 209.037 446.906 184.502C471.786 159.617 505.952 147.174 549.403 147.174C592.855 147.174 626.846 159.617 651.375 184.502C676.255 209.037 688.695 243.035 688.695 286.497C688.695 329.958 676.255 364.132 651.375 389.017C626.846 413.552 592.855 425.819 549.403 425.819ZM549.403 415.304C563.42 415.304 575.159 405.49 584.62 385.862C594.432 366.235 599.338 333.113 599.338 286.497C599.338 239.881 594.432 206.759 584.62 187.131C575.159 167.503 563.42 157.689 549.403 157.689C535.387 157.689 523.473 167.503 513.661 187.131C504.199 206.759 499.469 239.881 499.469 286.497C499.469 333.113 504.199 366.235 513.661 385.862C523.473 405.49 535.387 415.304 549.403 415.304ZM867.591 425.819C844.464 425.819 824.315 421.613 807.144 413.201C790.324 404.789 777.359 393.223 768.248 378.502C759.137 363.781 754.581 347.133 754.581 328.556V168.204H717.789V155.06H754.581V128.773C754.581 97.2285 770.35 81.4561 801.888 81.4561H838.682V155.06H912.27V168.204H838.682V328.556C838.682 360.802 842.011 382.883 848.669 394.8C855.327 406.717 865.138 412.675 878.104 412.675C890.719 412.675 901.757 406.542 911.218 394.274C920.68 382.007 925.41 365.358 925.41 344.329H938.551C938.551 370.265 932.068 390.419 919.103 404.789C906.137 418.809 888.967 425.819 867.591 425.819Z"
              fill="#484539"
              fillOpacity="0.1"
            />
          </CSSTransition>
          <CSSTransition
            in={true}
            timeout={400}
            classNames="animate-right"
            appear
          >
            <path
              className="svg-bg-path"
              d="M303.697 891.98L335.234 884.093V547.617L303.697 539.731V531.844H584.907V626.478H569.138C562.48 621.221 556.699 614.562 551.793 606.5C540.579 587.573 534.973 567.069 534.973 544.988H421.963V710.598H482.41C484.863 697.279 489.418 684.836 496.076 673.27C498.88 668.012 502.208 662.93 506.063 658.023H521.832V776.316H506.063C502.208 771.409 498.88 766.327 496.076 761.069C489.418 749.503 484.863 737.06 482.41 723.741H421.963V884.093L453.5 891.98V899.866H303.697V891.98ZM737.507 907.752C694.052 907.752 659.886 895.485 635.006 870.95C610.477 846.065 598.212 811.891 598.212 768.43C598.212 724.968 610.477 690.97 635.006 666.435C659.886 641.55 694.052 629.107 737.507 629.107C780.959 629.107 814.949 641.55 839.479 666.435C864.358 690.97 876.798 724.968 876.798 768.43C876.798 811.891 864.358 846.065 839.479 870.95C814.949 895.485 780.959 907.752 737.507 907.752ZM737.507 897.237C751.524 897.237 763.263 887.423 772.724 867.795C782.536 848.168 787.442 815.046 787.442 768.43C787.442 721.814 782.536 688.692 772.724 669.064C763.263 649.436 751.524 639.622 737.507 639.622C723.487 639.622 711.572 649.436 701.761 669.064C692.299 688.692 687.569 721.814 687.569 768.43C687.569 815.046 692.299 848.168 701.761 867.795C711.572 887.423 723.487 897.237 737.507 897.237ZM1045.18 907.752C1025.56 907.752 1007.86 903.721 992.093 895.66C976.675 887.248 964.585 876.383 955.825 863.064C947.064 849.745 942.684 835.725 942.684 821.004V652.766L911.147 644.88V636.993H979.478C1011.02 636.993 1026.78 652.766 1026.78 684.31V821.004C1026.78 843.085 1030.64 860.084 1038.35 872.001C1046.41 883.568 1055.69 889.351 1066.21 889.351C1079.17 889.351 1090.91 882.341 1101.42 868.321C1105.28 863.064 1109.31 856.054 1113.51 847.291V652.766L1081.98 644.88V636.993H1229.15V644.88L1197.61 652.766V902.495H1192.36C1166.78 902.495 1147.33 895.485 1134.01 881.465C1128.06 875.156 1123.85 868.146 1121.4 860.435C1116.49 869.197 1110.71 877.084 1104.05 884.093C1088.28 899.866 1068.66 907.752 1045.18 907.752ZM1260.89 891.98L1292.43 884.093V652.766L1260.89 644.88V636.993H1308.2C1328.87 636.993 1345.17 643.653 1357.08 656.972C1361.64 662.229 1365.49 668.713 1368.65 676.424C1373.55 667.311 1379.33 659.425 1385.99 652.766C1401.76 636.993 1421.38 629.107 1444.86 629.107C1464.49 629.107 1482.01 633.313 1497.43 641.725C1513.19 649.787 1525.46 660.477 1534.22 673.796C1542.98 687.114 1547.36 701.134 1547.36 715.855V884.093L1578.9 891.98V899.866H1510.57C1479.03 899.866 1463.26 884.093 1463.26 852.549V715.855C1463.26 693.774 1459.23 676.95 1451.17 665.384C1443.46 653.467 1434.35 647.508 1423.84 647.508C1410.52 647.508 1398.61 654.518 1388.1 668.538C1383.54 674.496 1379.68 681.506 1376.53 689.568V884.093L1408.07 891.98V899.866H1260.89V891.98ZM1718.21 907.752C1697.54 907.752 1679.14 902.495 1663.02 891.98C1646.9 881.114 1634.11 865.342 1624.65 844.663C1615.19 823.633 1610.46 798.222 1610.46 768.43C1610.46 723.566 1620.79 689.217 1641.47 665.384C1662.49 641.199 1690.7 629.107 1726.1 629.107C1742.92 629.107 1757.63 632.612 1770.25 639.622C1775.5 642.076 1780.94 645.581 1786.54 650.137V547.617L1755 539.731V531.844H1823.34C1854.87 531.844 1870.64 547.617 1870.64 579.161V884.093L1902.18 891.98V899.866H1854.87C1833.85 899.866 1817.55 893.382 1805.99 880.413C1801.08 875.156 1797.23 868.496 1794.43 860.435C1789.87 869.197 1784.09 877.084 1777.08 884.093C1761.31 899.866 1741.69 907.752 1718.21 907.752ZM1739.24 889.351C1752.2 889.351 1763.94 882.341 1774.45 868.321C1778.31 863.064 1782.34 856.054 1786.54 847.291V665.909C1782.69 662.054 1778.66 658.549 1774.45 655.394C1764.99 648.384 1755.88 644.88 1747.12 644.88C1732.05 644.88 1720.31 653.642 1711.9 671.167C1703.84 688.692 1699.81 721.113 1699.81 768.43C1699.81 813.644 1703.49 845.188 1710.85 863.064C1718.56 880.589 1728.02 889.351 1739.24 889.351Z"
              fill="#484539"
              fillOpacity="0.1"
            />
          </CSSTransition>
        </svg>
        <div className="homepage-content not-found">
          <CSSTransition
            in={true}
            timeout={400}
            classNames="animate-left"
            appear
          >
            <Fragment>
              <Link
                to="/"
                onClick={() => {
                  toggleActive("intro");
                }}
                className="button-like"
                style={linkBg}
              >
                Go Back Home
              </Link>
              <p>
                {"Don't"} worry, these Astronauts will bring you home in{" "}
                <span>{countDown}</span>
              </p>
              <div className="text">
                <h4>Error - Not Found</h4>
                <h1>Oops, it seems like you lost in space!</h1>
              </div>{" "}
              <NotfoundSVG currentlyLightTheme={currentlyLightTheme} />
            </Fragment>
          </CSSTransition>
        </div>
      </div>
    </Fragment>
  );
};

export default NotFound;
